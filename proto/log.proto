syntax = "proto3";

package log;

service LogService {
  rpc Put (PutRequest) returns (PutResponse) {}
  rpc Get (GetRequest) returns (GetResponse) {}
  rpc CreateTable (CreateTableRequest) returns (CreateTableResponse) {}
  rpc AddRecord (AddRecordRequest) returns (AddRecordResponse) {}
  rpc Scan (ScanRequest) returns (ScanResponse) {}
  rpc Filter (FilterRequest) returns (FilterResponse) {}
}

message PutRequest {
  string key = 1;
  bytes value = 2;
}

message PutResponse {
  bool success = 1;
}

message GetRequest {
  string key = 1;
}

message GetResponse {
  bytes value = 1;
  bool found = 2;
}

// Column type enum
enum ColumnType {
  INT64 = 0;
  FLOAT64 = 1;
  STRING = 2;
  BOOL = 3;
}

// Column definition
message ColumnDef {
  string name = 1;
  ColumnType type = 2;
}

// Table schema
message Schema {
  repeated ColumnDef columns = 1;
}

// Value that can be stored in a column
message Value {
  oneof value {
    int64 int64_value = 1;
    double float64_value = 2;
    string string_value = 3;
    bool bool_value = 4;
  }
}

// Create table request
message CreateTableRequest {
  string table_name = 1;
  Schema schema = 2;
}

message CreateTableResponse {
  bool success = 1;
  string error = 2;
}

// Add record request
message AddRecordRequest {
  string table_name = 1;
  repeated Value values = 2;
}

message AddRecordResponse {
  bool success = 1;
  string error = 2;
}

// Scan request (returns all rows)
message ScanRequest {
  string table_name = 1;
}

message ScanResponse {
  repeated Record records = 1;
  string error = 2;
}

message Record {
  repeated Value values = 1;
}

// Comparison operators for filter predicates
enum ComparisonOperator {
  EQUAL = 0;
  NOT_EQUAL = 1;
  LESS_THAN = 2;
  LESS_THAN_OR_EQUAL = 3;
  GREATER_THAN = 4;
  GREATER_THAN_OR_EQUAL = 5;
}

// Predicate for filtering rows
message Predicate {
  string column_name = 1;
  ComparisonOperator operator = 2;
  Value value = 3;
}

// Filter request (returns rows matching predicates)
message FilterRequest {
  string table_name = 1;
  repeated Predicate predicates = 2;
}

message FilterResponse {
  repeated Record records = 1;
  string error = 2;
}
